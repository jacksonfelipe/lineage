{% extends 'internal/layouts/screen.html' %}
{% load static %}
{% block title %}Chat{% endblock title %}


{% block extrahead %}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/emoji-button@4.6.0/dist/index.min.css">
<link rel="stylesheet" href="{% static 'css/chat.css' %}">
<link rel="stylesheet" href="{% static 'css/header.css' %}">
{% endblock extrahead %}

{% block title_scream %}Chat{% endblock title_scream %}

{% block breadcrumb_scream %}
    <li class="breadcrumb-item"><a href="javascript: void(0)">Mensagens</a></li>
{% endblock breadcrumb_scream %}

{% block head_scream %}
    <h5 class="display-5"><!-- CODE HERE --></h5>
{% endblock head_scream %}

{% block content_scream %}
<!-- Main Content start -->
<div class="row">

    <!-- Message start -->
    <div class="col-sm-12">

        <!-- Title start -->
        <div class="col-sm-12 mb-4 bg-light-gray p-4">
            <h2 class="fw-bold text-white">Mensagens</h2>
            <p class="text-muted">Converse com seus amigos de forma rápida e prática.</p>
        </div>      
        <!-- Title end -->

        <div class="card mb-0">
            <div class="card-body">
                <div class="row">

                    <!-- Friends list -->
                    <div class="col-lg-3 col-md-12">
                        <div class="message-mobile">
                            <div class="d-flex justify-content-between align-items-center mb-3">
                                <span class="fw-bold">Lista de Amigos</span>
                                <i class="fas fa-times" id="toggle-friend-list" style="cursor: pointer;"></i>
                            </div>

                            <!-- Se não houver amigos -->
                            {% if accepted_friendships %}
                                <!-- Campo de busca -->
                                <div id="friend-list" class="input-group mb-3">
                                    <input type="text" id="msg-friends" class="form-control" placeholder="Procurar Amigo..." oninput="filterFriends()">
                                    <span class="input-group-text"><i class="feather icon-search"></i></span>
                                </div>

                                <!-- Lista de amigos -->
                                <div id="friend-list-content" class="list-group overflow-auto mb-3" style="max-height: 500px;">
                                    {% for friendship in accepted_friendships %}
                                        <a href="#" class="list-group-item list-group-item-action d-flex align-items-center justify-content-between friend-item" data-friend-id="{{ friendship.friend.id }}">
                                            <div class="d-flex" style="gap: 8px;">
                                                <img src="{% if friendship.friend.avatar %}{{ friendship.friend.avatar.url }}{% else %}{% static 'internal/images/user/GenericAvatar.png' %}{% endif %}" class="rounded-circle me-3" alt="{{ friendship.friend.username }}" width="40" height="40">
                                                <div class="me-auto">
                                                    <h6 class="mb-0 friend-name">{{ friendship.friend.username }}</h6>
                                                    <small class="friend-status">
                                                        ...
                                                    </small>
                                                </div>
                                            </div>
                                            <span class="badge ms-auto" id="unread-count-{{ friendship.friend.id }}"></span>
                                        </a>
                                    {% endfor %}
                                </div>
                            {% else %}
                                <!-- Se não houver amigos -->
                                <div class="d-flex justify-content-center">
                                    <a href="{% url 'message:friends_list' %}" class="btn btn-primary">Gerenciar Amigos</a>
                                </div>
                            {% endif %}
                        </div>
                    </div>

                    <!-- Seção de Chat -->
                    <div class="col-lg-9 col-md-12">
                        <div class="chat-box border rounded p-3">
                            <div id="message-container" class="custom-overflow" style="max-height: 500px !important;">
                                <p class="text-center">Clique em um amigo para iniciar o chat.</p>
                            </div>
                            <hr>
                            <div class="input-group" id="message-input-group" style="display: none;">
                                <textarea id="message-input" class="form-control" placeholder="Digite uma mensagem..." rows="2"></textarea>
                                <button id="emoji-button" type="button" class="btn btn-outline-secondary">&#x1F60A;</button> <!-- Botão de Emoji -->
                                <button class="btn btn-primary" id="send-message" type="button"><i class="feather icon-play"></i></button>
                            </div>

                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>
    <!-- Message end -->
</div>
<!-- Main Content end -->
{% endblock content_scream %}

{% block extra_js %}
<!-- Emoji Button Script -->
<script src="https://cdn.jsdelivr.net/npm/@joeattardi/emoji-button@3.0.2/dist/index.min.js"></script>

<script>
    const currentUser = '{{ username }}';
    const csrfToken = '{{ csrf_token }}';
    const avatarUrl = '{% if avatar_url %}{{ avatar_url }}{% else %}{% static "internal/images/user/GenericAvatar.png" %}{% endif %}';
</script>

<script src="{% static 'js/chat.js' %}"></script>
{% endblock extra_js %}
