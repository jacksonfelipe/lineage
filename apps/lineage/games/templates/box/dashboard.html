{% extends "layouts/base.html" %}
{% load i18n static %}

{% block extrastyle %}
<link rel="stylesheet" href="{% static 'roulette/style.css' %}">
{% endblock extrastyle %}

{% block content %}
<div class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h2>{% trans "Tipos de Caixa Disponíveis" %}</h2>

        <!-- Botão de Comprar Fichas -->
        <div class="text-center mt-4 mb-4">
            <button class="btn btn-warning btn-lg rounded-pill" data-bs-toggle="modal" data-bs-target="#buyTokensModal">
            <i class="bi bi-cart-plus me-2"></i> Comprar Fichas
            </button>
        </div>
    </div>

    <!-- Exibir saldo do usuário -->
    <p class="mb-4">
        <strong>{% trans "Seu Saldo:" %}</strong>
        <span class="badge bg-primary">R$ {{ user_balance }}</span>
    </p>

    {% if box_types %}
    <div class="row row-cols-1 row-cols-md-3 g-4">
        {% for box_type in box_types %}
        <div class="col">
            <div class="card shadow-sm h-100 text-center border-0">
                <div class="card-body d-flex flex-column justify-content-between">
                    <div>
                        <h5 class="card-title text-uppercase fw-bold">{{ box_type.name }}</h5>
                        <p class="card-text text-muted small mb-3">
                            {% trans "Preço" %}: <strong>R$ {{ box_type.price }}</strong><br>
                            {% trans "Boosters" %}: {{ box_type.boosters_amount }}<br>
                            {% trans "Comum" %}: {{ box_type.chance_common }}% |
                            {% trans "Rara" %}: {{ box_type.chance_rare }}%<br>
                            {% trans "Épica" %}: {{ box_type.chance_epic }}% |
                            {% trans "Lendária" %}: {{ box_type.chance_legendary }}%
                        </p>
                    </div>

                    <a href="{% url 'games:box_buy_and_open' box_type.id %}" class="btn btn-primary mt-auto">
                        {% trans "Comprar e Abrir Caixa" %}
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="alert alert-warning mt-4" role="alert">
        {% trans "Nenhum tipo de caixa disponível no momento." %}
    </div>
    {% endif %}
</div>

<!-- Modal de Compra -->
<div class="modal fade" id="buyTokensModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content text-center p-4">
      <h5 class="modal-title mb-3">{% trans "Comprar Fichas" %}</h5>
      <p class="text-white">{% trans "Escolha a quantidade de fichas que deseja comprar. Valor: R$0,10 por ficha." %}</p>
      <input type="number" id="buyQuantity" class="form-control mb-3" min="1" value="1">
      <button class="btn btn-success" onclick="buyFichas()">{% trans "Confirmar Compra" %}</button>
    </div>
  </div>
</div>

  <meta name="csrf-token" content="{{ csrf_token }}">

  <script>
    const FICHAS_URL = "{% url 'games:comprar_fichas' %}";
  </script>

  <script src="{% static 'roulette/script.js' %}"></script>
{% endblock %}
