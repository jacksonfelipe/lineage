#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import os
import sys
import django
from reportlab.lib.pagesizes import A4
from reportlab.lib.styles import getSampleStyleSheet, ParagraphStyle
from reportlab.lib.units import inch
from reportlab.platypus import SimpleDocTemplate, Paragraph, Spacer, Table, TableStyle, PageBreak, Image, Frame, PageTemplate
from reportlab.lib import colors
from reportlab.lib.enums import TA_CENTER, TA_LEFT, TA_JUSTIFY, TA_RIGHT
from reportlab.pdfbase import pdfmetrics
from reportlab.pdfbase.ttfonts import TTFont
from reportlab.lib.units import cm
from datetime import datetime
import io

# Configurar Django
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'core.settings')
django.setup()

from apps.main.home.models import Conquista

def create_header_footer(canvas, doc):
    """Cria cabe√ßalho e rodap√© personalizados"""
    canvas.saveState()
    
    # Cabe√ßalho
    canvas.setFillColor(colors.darkblue)
    canvas.setFont("Helvetica-Bold", 12)
    canvas.drawString(72, A4[1] - 50, "üèÜ SISTEMA DE CONQUISTAS")
    
    # Linha decorativa no cabe√ßalho
    canvas.setStrokeColor(colors.darkblue)
    canvas.setLineWidth(2)
    canvas.line(72, A4[1] - 60, A4[0] - 72, A4[1] - 60)
    
    # Rodap√©
    canvas.setFillColor(colors.grey)
    canvas.setFont("Helvetica", 8)
    canvas.drawString(72, 30, f"Gerado em: {datetime.now().strftime('%d/%m/%Y √†s %H:%M')}")
    canvas.drawRightString(A4[0] - 72, 30, f"P√°gina {doc.page}")
    
    # Linha decorativa no rodap√©
    canvas.setStrokeColor(colors.grey)
    canvas.setLineWidth(1)
    canvas.line(72, 40, A4[0] - 72, 40)
    
    canvas.restoreState()

def create_achievement_box(conquista, instrucao, categoria_icon):
    """Cria uma caixa estilizada para cada conquista"""
    data = [
        [f"{categoria_icon} {conquista.nome}"],
        [f"üìù {conquista.descricao}"],
        [f"üéØ {instrucao}"]
    ]
    
    table = Table(data, colWidths=[400])
    table.setStyle(TableStyle([
        ('BACKGROUND', (0, 0), (-1, 0), colors.darkblue),
        ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
        ('ALIGN', (0, 0), (-1, -1), 'LEFT'),
        ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, 0), 12),
        ('FONTSIZE', (0, 1), (-1, -1), 10),
        ('BOTTOMPADDING', (0, 0), (-1, 0), 12),
        ('TOPPADDING', (0, 1), (-1, -1), 8),
        ('BOTTOMPADDING', (0, 1), (-1, -1), 8),
        ('GRID', (0, 0), (-1, -1), 1, colors.lightgrey),
        ('ROWBACKGROUNDS', (0, 1), (-1, -1), [colors.lightblue, colors.white]),
        ('VALIGN', (0, 0), (-1, -1), 'TOP'),
    ]))
    
    return table

def create_category_header(categoria_nome, total_conquistas):
    """Cria cabe√ßalho estilizado para categoria"""
    data = [[f"{categoria_nome} ({total_conquistas} conquistas)"]]
    
    table = Table(data, colWidths=[400])
    table.setStyle(TableStyle([
        ('BACKGROUND', (0, 0), (-1, 0), colors.darkgreen),
        ('TEXTCOLOR', (0, 0), (-1, 0), colors.white),
        ('ALIGN', (0, 0), (-1, -1), 'CENTER'),
        ('FONTNAME', (0, 0), (-1, 0), 'Helvetica-Bold'),
        ('FONTSIZE', (0, 0), (-1, 0), 14),
        ('BOTTOMPADDING', (0, 0), (-1, 0), 15),
        ('TOPPADDING', (0, 0), (-1, 0), 15),
        ('GRID', (0, 0), (-1, -1), 1, colors.darkgreen),
    ]))
    
    return table

def create_progress_bar(conquistas_categoria, total_conquistas):
    """Cria uma barra de progresso visual"""
    progresso = len(conquistas_categoria)
    porcentagem = (progresso / total_conquistas) * 100 if total_conquistas > 0 else 0
    
    # Criar barra de progresso com caracteres ASCII
    barra_completa = 20
    preenchido = int((porcentagem / 100) * barra_completa)
    vazio = barra_completa - preenchido
    
    barra = "‚ñà" * preenchido + "‚ñë" * vazio
    
    return f"Progresso: {barra} {porcentagem:.1f}% ({progresso}/{total_conquistas})"

def gerar_pdf_conquistas_detalhado():
    """Gera um PDF detalhado com todas as conquistas e instru√ß√µes espec√≠ficas"""
    
    # Configurar o documento com template personalizado
    doc = SimpleDocTemplate(
        "Guia_Conquistas_Detalhado.pdf",
        pagesize=A4,
        rightMargin=72,
        leftMargin=72,
        topMargin=100,
        bottomMargin=80
    )
    
    # Aplicar template com cabe√ßalho e rodap√©
    template = PageTemplate(id='custom', frames=[Frame(72, 80, A4[0]-144, A4[1]-160)], onPage=create_header_footer)
    doc.addPageTemplates([template])
    
    # Estilos aprimorados
    styles = getSampleStyleSheet()
    
    # Estilo para t√≠tulo principal com gradiente visual
    title_style = ParagraphStyle(
        'CustomTitle',
        parent=styles['Heading1'],
        fontSize=28,
        spaceAfter=40,
        alignment=TA_CENTER,
        textColor=colors.darkblue,
        fontName='Helvetica-Bold',
        borderWidth=2,
        borderColor=colors.darkblue,
        borderPadding=20,
        backColor=colors.lightblue
    )
    
    # Estilo para subt√≠tulos com √≠cones
    subtitle_style = ParagraphStyle(
        'CustomSubtitle',
        parent=styles['Heading2'],
        fontSize=18,
        spaceAfter=15,
        spaceBefore=25,
        textColor=colors.darkgreen,
        fontName='Helvetica-Bold',
        leftIndent=0
    )
    
    # Estilo para descri√ß√µes com melhor legibilidade
    desc_style = ParagraphStyle(
        'CustomDesc',
        parent=styles['Normal'],
        fontSize=11,
        spaceAfter=10,
        alignment=TA_JUSTIFY,
        fontName='Helvetica',
        leftIndent=20,
        rightIndent=20,
        backColor=colors.lightgrey,
        borderWidth=1,
        borderColor=colors.grey,
        borderPadding=10
    )
    
    # Estilo para conquistas individuais
    achievement_style = ParagraphStyle(
        'Achievement',
        parent=styles['Normal'],
        fontSize=11,
        spaceAfter=5,
        spaceBefore=5,
        leftIndent=0,
        fontName='Helvetica'
    )
    
    # Estilo para instru√ß√µes com destaque
    instruction_style = ParagraphStyle(
        'Instruction',
        parent=styles['Normal'],
        fontSize=10,
        spaceAfter=8,
        spaceBefore=8,
        leftIndent=30,
        textColor=colors.darkred,
        fontName='Helvetica-Oblique',
        backColor=colors.lightyellow,
        borderWidth=1,
        borderColor=colors.orange,
        borderPadding=5
    )
    
    # Estilo para estrat√©gias
    strategy_style = ParagraphStyle(
        'Strategy',
        parent=styles['Normal'],
        fontSize=11,
        spaceAfter=12,
        spaceBefore=8,
        leftIndent=20,
        fontName='Helvetica',
        backColor=colors.lightgreen,
        borderWidth=1,
        borderColor=colors.green,
        borderPadding=8
    )
    
    # Estilo para estat√≠sticas
    stats_style = ParagraphStyle(
        'Stats',
        parent=styles['Normal'],
        fontSize=11,
        spaceAfter=8,
        spaceBefore=8,
        leftIndent=20,
        fontName='Helvetica',
        backColor=colors.lightcyan,
        borderWidth=1,
        borderColor=colors.cyan,
        borderPadding=8
    )
    
    # Conte√∫do do PDF
    story = []
    
    # T√≠tulo principal com design aprimorado
    story.append(Paragraph("üèÜ GUIA COMPLETO DE CONQUISTAS", title_style))
    story.append(Spacer(1, 30))
    
    # Introdu√ß√£o com design melhorado
    intro_text = """
    <b>Bem-vindo ao Sistema de Conquistas!</b><br/><br/>
    
    Este guia completo cont√©m todas as conquistas dispon√≠veis no sistema, suas descri√ß√µes detalhadas e instru√ß√µes espec√≠ficas 
    sobre como obt√™-las. As conquistas s√£o uma forma de reconhecer suas atividades e progresso no jogo, oferecendo 
    recompensas especiais diretamente para seu invent√°rio!<br/><br/>
    
    <b>Caracter√≠sticas do Sistema:</b><br/>
    ‚Ä¢ <b>Recompensas Autom√°ticas:</b> Itens especiais enviados diretamente para seu invent√°rio<br/>
    ‚Ä¢ <b>Progress√£o Gradual:</b> Conquistas organizadas por dificuldade e categoria<br/>
    ‚Ä¢ <b>Reconhecimento Cont√≠nuo:</b> Novas conquistas s√£o adicionadas regularmente<br/>
    ‚Ä¢ <b>Comunidade Ativa:</b> Conquistas que incentivam intera√ß√£o entre jogadores
    """
    story.append(Paragraph(intro_text, desc_style))
    story.append(Spacer(1, 30))
    
    # Dicion√°rio com instru√ß√µes espec√≠ficas para cada conquista
    instrucoes_conquistas = {
        # Conquistas de Primeira Vez
        "primeiro_login": "Fa√ßa login pela primeira vez no sistema",
        "primeira_solicitacao": "Abra sua primeira solicita√ß√£o de suporte",
        "avatar_editado": "Edite seu avatar no perfil pela primeira vez",
        "endereco_cadastrado": "Cadastre seu endere√ßo no perfil",
        "email_verificado": "Verifique seu email atrav√©s do link enviado",
        "2fa_ativado": "Ative a autentica√ß√£o de dois fatores no perfil",
        "idioma_trocado": "Altere o idioma do sistema no perfil",
        "primeiro_amigo": "Envie seu primeiro pedido de amizade",
        "primeiro_amigo_aceito": "Aceite seu primeiro pedido de amizade",
        "primeira_compra": "Fa√ßa sua primeira compra na loja",
        "primeiro_lance": "Fa√ßa seu primeiro lance em um leil√£o",
        "primeiro_cupom": "Aplique um c√≥digo promocional pela primeira vez",
        "primeiro_pedido_pagamento": "Inicie sua primeira contribui√ß√£o para o servidor",
        "primeiro_pagamento_concluido": "Complete seu primeiro pagamento de apoio",
        "primeira_transferencia_para_o_jogo": "Transfira moedas para o jogo pela primeira vez",
        "primeira_transferencia_para_jogador": "Envie moedas para outro jogador pela primeira vez",
        "primeira_retirada_item": "Retire um item do jogo para o invent√°rio online",
        "primeira_insercao_item": "Insira um item do invent√°rio online no servidor",
        "primeira_troca_itens": "Realize sua primeira troca de item entre personagens",
        "primeiro_vencedor_leilao": "Vence seu primeiro leil√£o",
        "primeiro_bonus": "Receba seu primeiro b√¥nus de compra",
        
        # Conquistas de Invent√°rio
        "colecionador_itens": "Acumule 10 ou mais itens no seu invent√°rio",
        "mestre_inventario": "Acumule 50 ou mais itens no seu invent√°rio",
        "trocador_incansavel": "Realize 10 ou mais trocas de itens",
        
        # Conquistas de Carteira
        "gerenciador_economico": "Realize 20 ou mais transfer√™ncias para o jogo",
        "benfeitor_comunitario": "Realize 10 ou mais transfer√™ncias para outros jogadores",
        "100_transacoes": "Realize 100 transa√ß√µes na carteira",
        "250_transacoes": "Realize 250 transa√ß√µes na carteira",
        "500_transacoes": "Realize 500 transa√ß√µes na carteira",
        
        # Conquistas de B√¥nus
        "bonus_diario_7dias": "Receba b√¥nus di√°rio por 7 dias consecutivos",
        "bonus_diario_30dias": "Receba b√¥nus di√°rio por 30 dias consecutivos",
        "bonus_mestre": "Receba 10 ou mais b√¥nus",
        "bonus_expert": "Receba 25 ou mais b√¥nus",
        
        # Conquistas de Patroc√≠nio
        "patrocinador_ouro": "Realize 5 ou mais pagamentos aprovados",
        "patrocinador_diamante": "Realize 10 ou mais pagamentos aprovados",
        
        # Conquistas de Loja
        "comprador_frequente": "Realize 5 ou mais compras na loja",
        "comprador_vip": "Realize 15 ou mais compras na loja",
        
        # Conquistas de Leil√µes
        "10_leiloes": "Crie 10 leil√µes no sistema",
        "leiloeiro_profissional": "Crie 25 ou mais leil√µes",
        "leiloeiro_mestre": "Crie 50 ou mais leil√µes",
        "50_lances": "Realize 50 lances em leil√µes",
        "lanceador_profissional": "Realize 100 ou mais lances",
        "lanceador_mestre": "Realize 200 ou mais lances",
        "vencedor_serie": "Vence 3 ou mais leil√µes",
        "vencedor_mestre": "Vence 10 ou mais leil√µes",
        
        # Conquistas de Cupons
        "cupom_mestre": "Aplique 5 ou mais cupons promocionais",
        "cupom_expert": "Aplique 15 ou mais cupons promocionais",
        
        # Conquistas de Suporte
        "solicitante_frequente": "Abra 5 ou mais solicita√ß√µes de suporte",
        "solicitante_expert": "Abra 15 ou mais solicita√ß√µes de suporte",
        "resolvedor_problemas": "Tenha 3 ou mais solicita√ß√µes resolvidas",
        "resolvedor_mestre": "Tenha 10 ou mais solicita√ß√µes resolvidas",
        
        # Conquistas de Rede Social
        "rede_social": "Tenha 5 ou mais amigos aceitos",
        "rede_social_mestre": "Tenha 15 ou mais amigos aceitos",
        
        # Conquistas de N√≠vel
        "nivel_10": "Alcance o n√≠vel 10 no sistema",
        "nivel_25": "Alcance o n√≠vel 25 no sistema",
        "nivel_50": "Alcance o n√≠vel 50 no sistema",
        "nivel_75": "Alcance o n√≠vel 75 no sistema",
        "nivel_100": "Alcance o n√≠vel 100 no sistema",
        
        # Conquistas de Experi√™ncia
        "1000_xp": "Acumule 1000 pontos de experi√™ncia",
        "5000_xp": "Acumule 5000 pontos de experi√™ncia",
        "10000_xp": "Acumule 10000 pontos de experi√™ncia"
    }
    
    # Categorias de conquistas com √≠cones
    categorias = {
        "üéÆ CONQUISTAS DE PRIMEIRA VEZ": [
            "primeiro_login",
            "primeira_solicitacao", 
            "avatar_editado",
            "endereco_cadastrado",
            "email_verificado",
            "2fa_ativado",
            "idioma_trocado",
            "primeiro_amigo",
            "primeiro_amigo_aceito",
            "primeira_compra",
            "primeiro_lance",
            "primeiro_cupom",
            "primeiro_pedido_pagamento",
            "primeiro_pagamento_concluido",
            "primeira_transferencia_para_o_jogo",
            "primeira_transferencia_para_jogador",
            "primeira_retirada_item",
            "primeira_insercao_item",
            "primeira_troca_itens",
            "primeiro_vencedor_leilao",
            "primeiro_bonus"
        ],
        
        "üì¶ CONQUISTAS DE INVENT√ÅRIO": [
            "colecionador_itens",
            "mestre_inventario",
            "trocador_incansavel"
        ],
        
        "üí∞ CONQUISTAS DE CARTEIRA E TRANSFER√äNCIAS": [
            "gerenciador_economico",
            "benfeitor_comunitario",
            "100_transacoes",
            "250_transacoes", 
            "500_transacoes"
        ],
        
        "üéÅ CONQUISTAS DE B√îNUS": [
            "bonus_diario_7dias",
            "bonus_diario_30dias",
            "bonus_mestre",
            "bonus_expert"
        ],
        
        "üíé CONQUISTAS DE PATROC√çNIO": [
            "patrocinador_ouro",
            "patrocinador_diamante"
        ],
        
        "üõí CONQUISTAS DE LOJA": [
            "comprador_frequente",
            "comprador_vip"
        ],
        
        "üèõÔ∏è CONQUISTAS DE LEIL√ïES": [
            "10_leiloes",
            "leiloeiro_profissional",
            "leiloeiro_mestre",
            "50_lances",
            "lanceador_profissional",
            "lanceador_mestre",
            "vencedor_serie",
            "vencedor_mestre"
        ],
        
        "üé´ CONQUISTAS DE CUPONS": [
            "cupom_mestre",
            "cupom_expert"
        ],
        
        "üÜò CONQUISTAS DE SUPORTE": [
            "solicitante_frequente",
            "solicitante_expert",
            "resolvedor_problemas",
            "resolvedor_mestre"
        ],
        
        "üë• CONQUISTAS DE REDE SOCIAL": [
            "rede_social",
            "rede_social_mestre"
        ],
        
        "üìà CONQUISTAS DE N√çVEL": [
            "nivel_10",
            "nivel_25",
            "nivel_50",
            "nivel_75",
            "nivel_100"
        ],
        
        "‚≠ê CONQUISTAS DE EXPERI√äNCIA": [
            "1000_xp",
            "5000_xp",
            "10000_xp"
        ]
    }
    
    # Buscar todas as conquistas do banco
    todas_conquistas = {c.codigo: c for c in Conquista.objects.all()}
    total_conquistas = len(todas_conquistas)
    
    # Gerar conte√∫do para cada categoria
    for categoria, codigos in categorias.items():
        # Cabe√ßalho da categoria
        story.append(create_category_header(categoria, len(codigos)))
        
        # Barra de progresso da categoria
        progresso_text = create_progress_bar(codigos, total_conquistas)
        story.append(Paragraph(f"<b>{progresso_text}</b>", achievement_style))
        story.append(Spacer(1, 15))
        
        # Conquistas da categoria
        for codigo in codigos:
            if codigo in todas_conquistas:
                conquista = todas_conquistas[codigo]
                
                # Criar caixa estilizada para a conquista
                categoria_icon = categoria.split()[0]  # Pega o √≠cone da categoria
                achievement_box = create_achievement_box(conquista, instrucoes_conquistas.get(codigo, "Instru√ß√£o n√£o dispon√≠vel"), categoria_icon)
                story.append(achievement_box)
                story.append(Spacer(1, 10))
        
        story.append(Spacer(1, 20))
    
    # Adicionar p√°gina de estrat√©gias com design melhorado
    story.append(PageBreak())
    story.append(Paragraph("üéØ ESTRAT√âGIAS AVAN√áADAS PARA MAXIMIZAR CONQUISTAS", subtitle_style))
    
    estrategias = [
        "<b>1. üéÆ Configure seu perfil completamente:</b><br/>‚Ä¢ Verifique email, configure 2FA, adicione endere√ßo e avatar<br/>‚Ä¢ Isso desbloqueia v√°rias conquistas de primeira vez de forma r√°pida",
        
        "<b>2. üìÖ Seja ativo diariamente:</b><br/>‚Ä¢ Receba b√¥nus di√°rios para acumular XP e conquistas de b√¥nus<br/>‚Ä¢ Participe regularmente para manter progresso constante",
        
        "<b>3. üèõÔ∏è Participe do sistema de leil√µes:</b><br/>‚Ä¢ Crie leil√µes para vender itens e ganhar moedas<br/>‚Ä¢ Lance em leil√µes de outros jogadores para encontrar itens raros<br/>‚Ä¢ Tente vencer leil√µes para conquistas espec√≠ficas de vencedor",
        
        "<b>4. üõí Use a loja regularmente:</b><br/>‚Ä¢ Fa√ßa compras para desbloquear conquistas de comprador<br/>‚Ä¢ Aplique cupons promocionais quando dispon√≠veis para economizar<br/>‚Ä¢ Mantenha-se atento a promo√ß√µes especiais",
        
        "<b>5. üë• Construa sua rede social:</b><br/>‚Ä¢ Adicione amigos e aceite solicita√ß√µes regularmente<br/>‚Ä¢ Mantenha uma rede ativa de jogadores para trocas<br/>‚Ä¢ Participe de grupos e comunidades",
        
        "<b>6. üí∞ Gerencie sua carteira estrategicamente:</b><br/>‚Ä¢ Fa√ßa transfer√™ncias para o jogo e outros jogadores<br/>‚Ä¢ Realize transa√ß√µes regularmente para acumular conquistas<br/>‚Ä¢ Mantenha um fluxo constante de moedas",
        
        "<b>7. üíé Contribua com o servidor:</b><br/>‚Ä¢ Fa√ßa pagamentos para se tornar patrocinador<br/>‚Ä¢ Apoie o desenvolvimento do servidor e receba benef√≠cios<br/>‚Ä¢ Alcance status de patrocinador ouro e diamante",
        
        "<b>8. üì¶ Gerencie seu invent√°rio eficientemente:</b><br/>‚Ä¢ Colecione itens do jogo de forma organizada<br/>‚Ä¢ Fa√ßa trocas entre personagens regularmente<br/>‚Ä¢ Mantenha um invent√°rio diversificado",
        
        "<b>9. üÜò Pe√ßa ajuda quando necess√°rio:</b><br/>‚Ä¢ Abra solicita√ß√µes de suporte quando tiver problemas<br/>‚Ä¢ Isso pode gerar conquistas de suporte e resolver quest√µes<br/>‚Ä¢ Mantenha um hist√≥rico de solicita√ß√µes resolvidas",
        
        "<b>10. üì¢ Mantenha-se informado:</b><br/>‚Ä¢ Fique atento a novos cupons e promo√ß√µes<br/>‚Ä¢ Participe de eventos especiais e tempor√°rios<br/>‚Ä¢ Siga as atualiza√ß√µes do sistema"
    ]
    
    for estrategia in estrategias:
        story.append(Paragraph(estrategia, strategy_style))
        story.append(Spacer(1, 8))
    
    # Adicionar p√°gina de recompensas com design melhorado
    story.append(PageBreak())
    story.append(Paragraph("üéÅ SISTEMA DE RECOMPENSAS DETALHADO", subtitle_style))
    
    recompensas_text = """
    <b>üèÜ Como funcionam as recompensas:</b><br/><br/>
    
    <b>üíé Recompensas por Conquista:</b><br/>
    ‚Ä¢ Cada conquista pode dar itens especiais do jogo diretamente para seu invent√°rio<br/>
    ‚Ä¢ Itens raros e exclusivos que n√£o podem ser obtidos de outra forma<br/>
    ‚Ä¢ Recompensas variam de acordo com a dificuldade da conquista<br/><br/>
    
    <b>üåü Recompensas por M√∫ltiplas Conquistas:</b><br/>
    ‚Ä¢ Desbloquear muitas conquistas pode dar recompensas extras<br/>
    ‚Ä¢ B√¥nus especiais para completar categorias inteiras<br/>
    ‚Ä¢ Recompensas progressivas conforme voc√™ avan√ßa<br/><br/>
    
    <b>üìà Recompensas por N√≠vel:</b><br/>
    ‚Ä¢ Subir de n√≠vel tamb√©m pode dar itens especiais<br/>
    ‚Ä¢ Recompensas maiores em n√≠veis importantes (10, 25, 50, 75, 100)<br/>
    ‚Ä¢ Benef√≠cios exclusivos para jogadores de alto n√≠vel<br/><br/>
    
    <b>‚ö° Sistema Autom√°tico:</b><br/>
    ‚Ä¢ As recompensas s√£o enviadas automaticamente para seu invent√°rio<br/>
    ‚Ä¢ Notifica√ß√µes instant√¢neas quando conquistas s√£o desbloqueadas<br/>
    ‚Ä¢ Sistema confi√°vel e sem necessidade de reivindica√ß√£o manual<br/><br/>
    
    <b>üéØ Recompensas √önicas:</b><br/>
    ‚Ä¢ Algumas conquistas d√£o recompensas exclusivas que n√£o podem ser obtidas de outra forma<br/>
    ‚Ä¢ Itens colecion√°veis especiais para mostrar seu progresso<br/>
    ‚Ä¢ T√≠tulos e badges exclusivos para seu perfil<br/><br/>
    
    <b>üí° Dica Pro:</b> Mantenha-se ativo e participe de todas as funcionalidades do sistema para maximizar suas recompensas e construir uma cole√ß√£o impressionante!
    """
    
    story.append(Paragraph(recompensas_text, desc_style))
    
    # Adicionar p√°gina de estat√≠sticas com design melhorado
    story.append(PageBreak())
    story.append(Paragraph("üìä ESTAT√çSTICAS COMPLETAS DO SISTEMA", subtitle_style))
    
    categorias_count = len(categorias)
    conquistas_primeira_vez = len(categorias['üéÆ CONQUISTAS DE PRIMEIRA VEZ'])
    conquistas_progresso = len(categorias['üìà CONQUISTAS DE N√çVEL']) + len(categorias['‚≠ê CONQUISTAS DE EXPERI√äNCIA'])
    conquistas_atividade = len(categorias['üèõÔ∏è CONQUISTAS DE LEIL√ïES']) + len(categorias['üõí CONQUISTAS DE LOJA'])
    
    stats_text = f"""
    <b>üìà Resumo completo do sistema de conquistas:</b><br/><br/>
    
    <b>üéØ Estat√≠sticas Gerais:</b><br/>
    ‚Ä¢ <b>Total de Conquistas:</b> {total_conquistas} conquistas dispon√≠veis<br/>
    ‚Ä¢ <b>Categorias:</b> {categorias_count} categorias diferentes<br/>
    ‚Ä¢ <b>Conquistas de Primeira Vez:</b> {conquistas_primeira_vez} conquistas (mais f√°ceis)<br/>
    ‚Ä¢ <b>Conquistas de Progresso:</b> {conquistas_progresso} conquistas (n√≠vel e XP)<br/>
    ‚Ä¢ <b>Conquistas de Atividade:</b> {conquistas_atividade} conquistas (leil√µes e loja)<br/><br/>
    
    <b>üìä Distribui√ß√£o por Categoria:</b><br/>
    ‚Ä¢ üéÆ Primeira Vez: {conquistas_primeira_vez} conquistas<br/>
    ‚Ä¢ üì¶ Invent√°rio: {len(categorias['üì¶ CONQUISTAS DE INVENT√ÅRIO'])} conquistas<br/>
    ‚Ä¢ üí∞ Carteira: {len(categorias['üí∞ CONQUISTAS DE CARTEIRA E TRANSFER√äNCIAS'])} conquistas<br/>
    ‚Ä¢ üéÅ B√¥nus: {len(categorias['üéÅ CONQUISTAS DE B√îNUS'])} conquistas<br/>
    ‚Ä¢ üíé Patroc√≠nio: {len(categorias['üíé CONQUISTAS DE PATROC√çNIO'])} conquistas<br/>
    ‚Ä¢ üõí Loja: {len(categorias['üõí CONQUISTAS DE LOJA'])} conquistas<br/>
    ‚Ä¢ üèõÔ∏è Leil√µes: {len(categorias['üèõÔ∏è CONQUISTAS DE LEIL√ïES'])} conquistas<br/>
    ‚Ä¢ üé´ Cupons: {len(categorias['üé´ CONQUISTAS DE CUPONS'])} conquistas<br/>
    ‚Ä¢ üÜò Suporte: {len(categorias['üÜò CONQUISTAS DE SUPORTE'])} conquistas<br/>
    ‚Ä¢ üë• Rede Social: {len(categorias['üë• CONQUISTAS DE REDE SOCIAL'])} conquistas<br/>
    ‚Ä¢ üìà N√≠vel: {len(categorias['üìà CONQUISTAS DE N√çVEL'])} conquistas<br/>
    ‚Ä¢ ‚≠ê Experi√™ncia: {len(categorias['‚≠ê CONQUISTAS DE EXPERI√äNCIA'])} conquistas<br/><br/>
    
    <b>üéØ Progresso Recomendado:</b><br/>
    1. üéÆ Comece pelas conquistas de primeira vez (mais f√°ceis e r√°pidas)<br/>
    2. üìÖ Foque em atividades di√°rias para acumular XP constantemente<br/>
    3. üèõÔ∏è Participe de leil√µes e use a loja regularmente<br/>
    4. üë• Construa sua rede social e mantenha conex√µes ativas<br/>
    5. üíé Contribua com o servidor para se tornar patrocinador<br/>
    6. üì¶ Gerencie invent√°rio e carteira de forma estrat√©gica<br/>
    7. üÜò Use o suporte quando necess√°rio<br/>
    8. üé´ Aproveite cupons e promo√ß√µes<br/>
    9. üìà Mantenha foco no progresso de n√≠vel<br/>
    10. ‚≠ê Acumule experi√™ncia atrav√©s de todas as atividades<br/><br/>
    
    <b>üí° Dica Final:</b> O sistema de conquistas √© projetado para recompensar tanto jogadores casuais quanto hardcore. 
    Cada atividade que voc√™ realiza no sistema pode contribuir para m√∫ltiplas conquistas simultaneamente!
    """
    
    story.append(Paragraph(stats_text, stats_style))
    
    # Adicionar p√°gina final com informa√ß√µes de contato
    story.append(PageBreak())
    story.append(Paragraph("üìû INFORMA√á√ïES DE CONTATO E SUPORTE", subtitle_style))
    
    contato_text = """
    <b>üÜò Precisa de ajuda?</b><br/><br/>
    
    <b>üìß Suporte T√©cnico:</b><br/>
    ‚Ä¢ Abra uma solicita√ß√£o de suporte atrav√©s do sistema<br/>
    ‚Ä¢ Nossa equipe responder√° o mais r√°pido poss√≠vel<br/>
    ‚Ä¢ Inclua detalhes espec√≠ficos sobre seu problema<br/><br/>
    
    <b>üìö Recursos Adicionais:</b><br/>
    ‚Ä¢ Este guia √© atualizado regularmente com novas conquistas<br/>
    ‚Ä¢ Fique atento √†s atualiza√ß√µes do sistema<br/>
    ‚Ä¢ Participe da comunidade para dicas e truques<br/><br/>
    
    <b>üéØ Objetivo do Sistema:</b><br/>
    ‚Ä¢ Recompensar jogadores ativos e dedicados<br/>
    ‚Ä¢ Criar uma experi√™ncia envolvente e progressiva<br/>
    ‚Ä¢ Fomentar a intera√ß√£o entre membros da comunidade<br/>
    ‚Ä¢ Manter o engajamento atrav√©s de metas claras<br/><br/>
    
    <b>üåü Boa sorte em sua jornada de conquistas!</b><br/>
    Que cada conquista seja um passo em dire√ß√£o ao sucesso no jogo!
    """
    
    story.append(Paragraph(contato_text, desc_style))
    
    # Gerar o PDF
    doc.build(story)
    print("‚úÖ PDF detalhado gerado com sucesso: Guia_Conquistas_Detalhado.pdf")
    print("üìä Estat√≠sticas do PDF:")
    print(f"   ‚Ä¢ Total de conquistas: {total_conquistas}")
    print(f"   ‚Ä¢ Categorias: {categorias_count}")
    print(f"   ‚Ä¢ P√°ginas estimadas: {len(story) // 15 + 1}")

if __name__ == "__main__":
    try:
        gerar_pdf_conquistas_detalhado()
    except Exception as e:
        print(f"‚ùå Erro ao gerar PDF detalhado: {e}")
        sys.exit(1) 